# üöÄ CrypGo Trading Bot - Guia de Deploy na VPS

Este guia ir√° te ajudar a fazer o deploy completo do CrypGo Trading Bot na sua VPS.

## üìã Pr√©-requisitos

- VPS com Ubuntu 20.04+ ou Debian 11+
- Acesso root via SSH
- Pelo menos 2GB de RAM
- 20GB de espa√ßo em disco

## üöÄ Instala√ß√£o R√°pida

**M√©todo 1: Transferir projeto do seu PC (Recomendado at√© subir no GitHub)**

```bash
# No seu PC - criar arquivo compactado
cd /Users/almeida/GolandProjects/
tar --exclude='.git' --exclude='*.log' --exclude='tmp' -czf crypgo-machine.tar.gz crypgo-machine/

# Transferir para VPS e instalar tudo
scp crypgo-machine.tar.gz root@31.97.249.4:/tmp/
ssh root@31.97.249.4 "cd /tmp && tar -xzf crypgo-machine.tar.gz && cd crypgo-machine && chmod +x scripts/*.sh && ./scripts/install-vps.sh && mv /tmp/crypgo-machine /opt/ && cd /opt/crypgo-machine && nano .env.production"
```

**M√©todo 2: Via GitHub (quando estiver p√∫blico)**

```bash
ssh root@31.97.249.4 "curl -fsSL https://raw.githubusercontent.com/almeidacavalcante/crypgo-machine/main/scripts/install-vps.sh | bash && cd /opt && git clone https://github.com/almeidacavalcante/crypgo-machine.git && cd crypgo-machine && chmod +x scripts/*.sh"
```

Depois execute o deploy:

```bash
ssh root@31.97.249.4
cd /opt/crypgo-machine
# Editar suas chaves da Binance
nano .env.production  
# Executar deploy
./scripts/deploy.sh
```

## üîß Processo de Instala√ß√£o Detalhado

### 1. **Transferir o Projeto para VPS**

```bash
# No seu PC - criar arquivo compactado
cd /Users/almeida/GolandProjects/
tar --exclude='.git' --exclude='*.log' --exclude='tmp' -czf crypgo-machine.tar.gz crypgo-machine/

# Transferir para VPS
scp crypgo-machine.tar.gz root@31.97.249.4:/opt/

# Na VPS - extrair e configurar
ssh root@31.97.249.4
cd /opt
tar -xzf crypgo-machine.tar.gz
cd crypgo-machine
chmod +x scripts/*.sh
```

### 2. **Instalar Depend√™ncias na VPS**

```bash
# Executar script de instala√ß√£o autom√°tica
./scripts/install-vps.sh
```

### 3. **Configurar Ambiente de Produ√ß√£o**

```bash
# Editar arquivo de configura√ß√£o de produ√ß√£o
nano .env.production
```

**IMPORTANTE**: Altere os seguintes valores:

```env
# Suas chaves reais da Binance
BINANCE_API_KEY=sua_chave_api_real_aqui
BINANCE_SECRET_KEY=sua_chave_secreta_real_aqui

# Senhas fortes para produ√ß√£o
DB_PASSWORD=UmaSenhaFortePara0Banco123!
RABBIT_MQ_URL=amqp://admin:UmaSenhaFortePara0RabbitMQ456!@localhost:5672/
```

### 4. **Executar Deploy Autom√°tico**

```bash
# Executar script de deploy completo
./scripts/deploy.sh
```

Este script ir√°:
- ‚úÖ Configurar ambiente de produ√ß√£o
- ‚úÖ Subir PostgreSQL e RabbitMQ
- ‚úÖ Aplicar todas as migrations
- ‚úÖ Compilar a aplica√ß√£o
- ‚úÖ Configurar como servi√ßo systemd
- ‚úÖ Iniciar a aplica√ß√£o

### 5. **Verificar Instala√ß√£o**

```bash
# Verificar status da aplica√ß√£o
sudo systemctl status crypgo-machine

# Testar endpoints
curl http://localhost:8080/api/v1/trading/list

# Ver logs em tempo real
sudo journalctl -u crypgo-machine -f
```

## üìä Monitoramento

### Comandos √öteis:

```bash
# Status dos servi√ßos
sudo systemctl status crypgo-machine
docker-compose -f docker-compose.production.yml ps

# Logs da aplica√ß√£o
sudo journalctl -u crypgo-machine -f

# Logs do PostgreSQL
docker logs crypgo-postgres-prod -f

# Logs do RabbitMQ
docker logs crypgo-rabbitmq-prod -f

# Reiniciar aplica√ß√£o
sudo systemctl restart crypgo-machine

# Parar aplica√ß√£o
sudo systemctl stop crypgo-machine

# Iniciar aplica√ß√£o
sudo systemctl start crypgo-machine
```

### Endpoints da API:

- **Lista de Bots**: `http://31.97.249.4:8080/api/v1/trading/list`
- **Criar Bot**: `http://31.97.249.4:8080/api/v1/trading/create_trading_bot`
- **Iniciar Bot**: `http://31.97.249.4:8080/api/v1/trading/start`
- **Backtest**: `http://31.97.249.4:8080/api/v1/trading/backtest`

### Interfaces Web:

- **RabbitMQ Management**: `http://31.97.249.4:15672`
  - User: `admin`
  - Password: (conforme configurado em .env.production)

### Testes de API:

```bash
# Testar se API est√° funcionando
curl http://31.97.249.4:8080/api/v1/trading/list

# Criar um bot de exemplo
curl -X POST http://31.97.249.4:8080/api/v1/trading/create_trading_bot \
  -H "Content-Type: application/json" \
  -d '{
    "symbol": "SOLBRL",
    "quantity": 0.02,
    "strategy": "MovingAverage",
    "params": {
      "FastWindow": 7,
      "SlowWindow": 40
    },
    "interval_seconds": 1800,
    "initial_capital": 10000.0,
    "trade_amount": 4000.0,
    "currency": "BRL",
    "trading_fees": 0.001,
    "minimum_profit_threshold": 5.0
  }'
```

## üíæ Backup e Recupera√ß√£o

### Fazer Backup:

```bash
# Backup autom√°tico do banco
./scripts/backup-database.sh
```

### Restaurar Backup:

```bash
# Listar backups dispon√≠veis
ls -la /opt/crypgo-machine/backups/

# Restaurar backup espec√≠fico
gunzip /opt/crypgo-machine/backups/crypgo_machine_backup_YYYYMMDD_HHMMSS.sql.gz
PGPASSWORD='sua_senha' psql -h localhost -U crypgo_prod -d crypgo_machine_prod < backup_file.sql
```

## üì§ Subir Projeto para GitHub (Opcional)

Para usar o m√©todo de instala√ß√£o via GitHub, primeiro suba o projeto:

```bash
# No seu PC local
cd /Users/almeida/GolandProjects/crypgo-machine

# Adicionar todos os arquivos (incluindo scripts)
git add .
git commit -m "feat: adicionar scripts de deploy e configura√ß√µes de produ√ß√£o"
git push origin main

# Verificar se subiu corretamente
echo "Verifique se o arquivo existe em:"
echo "https://raw.githubusercontent.com/almeidacavalcante/crypgo-machine/main/scripts/install-vps.sh"
```

Depois disso, voc√™ pode usar o m√©todo via GitHub no README.

## üîÑ Atualiza√ß√µes

Para atualizar a aplica√ß√£o:

```bash
# 1. Parar aplica√ß√£o
sudo systemctl stop crypgo-machine

# 2. Fazer backup
./scripts/backup-database.sh

# 3. Atualizar c√≥digo do GitHub
git pull origin main

# 4. Recompilar
go build -ldflags="-w -s" -o crypgo-machine main.go

# 5. Aplicar novas migrations (se houver)
./scripts/run-migrations.sh

# 6. Reiniciar aplica√ß√£o
sudo systemctl start crypgo-machine
```

### Atualiza√ß√£o R√°pida (Recomendado):

```bash
# Usar o script de atualiza√ß√£o autom√°tica
./scripts/update.sh
```

Este script ir√°:
- ‚úÖ Fazer backup autom√°tico
- ‚úÖ Verificar atualiza√ß√µes no GitHub
- ‚úÖ Atualizar c√≥digo automaticamente
- ‚úÖ Recompilar a aplica√ß√£o
- ‚úÖ Aplicar novas migrations
- ‚úÖ Reiniciar a aplica√ß√£o

## üö® Solu√ß√£o de Problemas

### Aplica√ß√£o n√£o inicia:

```bash
# Verificar logs detalhados
sudo journalctl -u crypgo-machine --no-pager -l

# Verificar se o banco est√° rodando
docker ps | grep postgres

# Testar conex√£o manual
PGPASSWORD='sua_senha' psql -h localhost -U crypgo_prod -d crypgo_machine_prod -c "SELECT version();"
```

### Problemas de performance:

```bash
# Verificar recursos do sistema
htop
df -h
free -h

# Verificar logs do banco
docker logs crypgo-postgres-prod --tail 100
```

### Problemas de conectividade:

```bash
# Verificar portas abertas
netstat -tlnp | grep :8080
netstat -tlnp | grep :5432

# Verificar firewall
ufw status
```

## üìû Suporte

Se encontrar problemas:

1. Verifique os logs primeiro
2. Consulte a documenta√ß√£o
3. Verifique as configura√ß√µes do .env.production
4. Teste conex√µes manuais com banco e APIs

## üîê Seguran√ßa

Recomenda√ß√µes importantes:

- ‚úÖ Altere todas as senhas padr√£o
- ‚úÖ Configure firewall adequadamente
- ‚úÖ Mantenha backups regulares
- ‚úÖ Monitore logs regularmente
- ‚úÖ Use chaves API com permiss√µes m√≠nimas necess√°rias
- ‚úÖ Considere usar HTTPS em produ√ß√£o